let net = require('net')

// let t24connect = net.createServer((socket)=>{
//   console.log(socket)
// });

// t24connect.listen(9080,'10.133.17.171')

let HOST = '10.133.17.171'
let PORT = 9080

// let HOST = '41.90.126.33'
// let PORT = 8852
// 8852
// 9501

let t24Socket = net.createConnection(PORT,HOST)

let sock = new net.Socket()

// let str = 'FUNDS.TRANSFER,KBS.MLOAN/I/PROCESS,MBK/123455/KE0010001,,MB.MEMBER.NO=43307,DEBIT.AMOUNT=20000.0,MLOAN.TYPE=30'
// let str = 'ENQUIRY.SELECT,,MBK/123455/KE0010001,KBS.MB.PROC,CUSTOMER.NO:EQ=43307,TRANSACTION.CODE:EQ=BAL'
// let str = 'FUNDS.TRANSFER,MPESA.WITHDRAWAL/I/VALIDATE,MBK/123455/KE0010001,,MB.MEMBER.NO=43307,DEBIT.AMOUNT=200.0,PHONE.NUMBER=254720831465'
// let str = 'FUNDS.TRANSFER,MPESA.WITHDRAWAL/I/PROCESS,MBK/********/KE0010001,,MB.MEMBER.NO=43307,DEBIT.AMOUNT=200.0,PHONE.NUMBER=254720831465'
// let str = 'FUNDS.TRANSFER,KBS.MB.MPESA.DEPOSIT/I/PROCESS,MBK/********/KE0010001,MGL5N0K2IR,DEBIT.AMOUNT=1050.0,CREDIT.THEIR.REF=200'
// let str = 'ENQUIRY.SELECT,,MBK/********/KE0010001,KBS.MB.PROC,CUSTOMER.NO:EQ=29991,TRANSACTION.CODE:EQ=LBAL'
// let str = 'ENQUIRY.SELECT,,MBK/********/KE0010001,KBS.MB.PROC,CUSTOMER.NO:EQ=43307,TRANSACTION.CODE:EQ=EST'
// let str = 'ENQUIRY.SELECT,,MBK/********/KE0010001,KBS.MB.PROC,CUSTOMER.NO:EQ=43307,TRANSACTION.CODE:EQ=LAE'
// let str = 'FUNDS.TRANSFER,KBS.AIRTIME/I/PROCESS,MBK/********/KE0010001,,MB.MEMBER.NO=43307,DEBIT.AMOUNT=100.0'
// let str = 'FUNDS.TRANSFER,KBS.ELECT/I/PROCESS,MBK/********/KE0010001,,MB.MEMBER.NO=43307,DEBIT.AMOUNT=500.0'
// let str = 'FUNDS.TRANSFER,KBS.MB.FOSA.ADVANCE/I/PROCESS,MBK/********/KE0010001,,MB.MEMBER.NO=43307,DEBIT.AMOUNT=10000.0'
// let str = `CUSTOMER_POSITION=ENQUIRY.SELECT,,MBK/123455/KE0010001,KBS.MB.PROC,CUSTOMER.NO:EQ=43307,TRANSACTION.CODE:EQ=CSP`

// let str = `ENQUIRY.SELECT,,INPUTT/Le@ve123/KE0010001,KBS.APPL.GUARANT,CUSTOMER.NO:EQ=29991,TRANSACTION.CODE:EQ=BAL`
// let str = `ENQUIRY.SELECT,,INPUTT/Le@ve123/KE0010001,KBS.APPL.GUARANT,CUSTOMER.NO:EQ=29991,TRANSACTION.CODE:EQ=LBAL`
// let str = `ENQUIRY.SELECT,,INPUTT/Le@ve123/KE0010001,KBS.APPL.GUARANT,CUSTOMER.NO:EQ=30469,TRANSACTION.CODE:EQ=MIN,CREDIT.AC.NO:EQ=01030469011`

// let str = `ENQUIRY.SELECT,,INPUTT/Le@ve123/KE0010001,KBS.LOAN.APPL.APP,CUSTOMER.NO:EQ=30469,PHONE.NO:EQ=254721615262,LOAN.AMOUNT:EQ=100000,LOAN.TYPE:EQ=3007,LOAN.PURPOSE:EQ=14,GUARANTORS:EQ=29991`
// let str = `ENQUIRY.SELECT,,INPUTT/Le@ve123/KE0010001,KBS.LOAN.APPL.APP,CUSTOMER.NO:EQ=30469,PHONE.NO:EQ=254799361115,LOAN.AMOUNT:EQ=1000,LOAN.TERM:EQ=24M,LOAN.TYPE:EQ=SaccoEducation,LOAN.PURPOSE:EQ=14,GUARANTORS:EQ=29991`

let str = `ENQUIRY.SELECT,,INPUTT/Le@ve123/KE0010001,KBS.LOAN.APPL.APP,CUSTOMER.NO:EQ=30469,PHONE.NO:EQ=254799361115,LOAN.AMOUNT:EQ=1000,LOAN.TERM:EQ=24M,LOAN.TYPE:EQ=SaccoEducation,LOAN.PURPOSE:EQ=14,GUARANTORS:EQ='29991:40304:30469:30155'`

// let str = `LOAN_AMOUNT_ELIGIBLE=ENQUIRY.SELECT,,MBK/123455/KE0010001,KBS.MB.PROC,CUSTOMER.NO:EQ=43307,TRANSACTION.CODE:EQ=LAE`

// count string
let strlen = (str.length).toString()
// pad str
let paddedStr = strlen.padStart(4,0)+str

console.log("PADDEDSTR:",paddedStr)  

// VALIDATE ROUTINES

sock.connect(PORT,HOST,()=>{
  console.log('CONNECTED TO: ' + HOST + ':' + PORT);
  // Write a message to the socket as soon as the client is connected, the server will   receive it as message from the client     
  sock.write(paddedStr);      
})

sock.on('data',(data)=>{
  console.log('DATA: ' + data);
    // Close the client socket completely
    // client.destroy();
})

sock.on('error', function(exception){
  console.log('Exception:');
  console.log(exception);
});


sock.on('drain', function() {
  console.log("drain!");
});

sock.on('timeout', function() {
  console.log("timeout!");
});

// Add a 'close' event handler for the client socket
sock.on('close', function() {
   console.log('Connection closed');
});